#!/usr/bin/env bash

set -eux

npm config set '//registry.npmjs.org/:_authToken' "$NPM_TOKEN"


yarn build


cd dist


VERSION="$(node -p "require('./package.json').version")"


if [[ "$VERSION" =~ -([a-zA-Z]+) ]]; then

  TAG="${BASH_REMATCH[1]}"
else
  TAG="latest"
fi

# Publish with the appropriate tag
yarn publish --access public --tag "$TAG"